<!DOCTYPE html>
<html>
   <head>
      <title></title>
      <meta name="apple-mobile-web-app-capable" content="yes">
      <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet" type="text/css"/>
      <meta name="viewport" content="width = device-width, initial-scale = 1"/>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <link  rel="icon" href="favicon.png" type="image/png"/>
      <link rel="shortcut icon" href="favicon.png" type="image/png""/>
      <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
      <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script> 
      <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
      <link rel="stylesheet" href="style.css">
      <style>
        
      </style>
      <script type = "text/javascript" language = "javascript">
         var mqtt;
         var clientID = Math.random().toString(36).substring(2, 5) + Math.random().toString(36).substring(2, 5);
         var reconnectTimeout = 2000;
         var host="192.168.200.186"; //change this
         var port=1884;
         
        function pub(value,topic){
         	message = new Paho.MQTT.Message(value);
         	message.destinationName = topic;
         	message.retained = true;
         	mqtt.send(message);
         }

         function onConnect() {
         // Once a connection has been made, make a subscription and send a message.
         	console.log("Connected ");
         	mqtt.subscribe('home/light_power');
         	mqtt.subscribe('home/temperature_power');
         	mqtt.subscribe('home/security_power');
         	mqtt.subscribe('home/light_sensor');     
         	mqtt.subscribe('home/blind_status');  
         	mqtt.subscribe('home/temperature_set');
         }
         
         function MQTTconnect() {
         	console.log("connecting to "+ host +" "+ port);
	        mqtt = new Paho.MQTT.Client(host,port,"/home",clientID);
	        mqtt.onMessageArrived = onMessageArrived;
	        var options = {
	           timeout: 3,
	           onSuccess: onConnect,
	        };
         	mqtt.connect(options);
         }

         function onMessageArrived(message) {
  			var new_message = message.payloadString;
  			var topic = message.destinationName;
  			switch(topic) {
  				case 'home/light_power':
  					
  					break;
  				case 'home/light_sensor':
  					var val = document.getElementById("light-number").innerHTML = new_message;
  					break;
  				case 'home/temperature_sensor':
  					var val = document.getElementById("temp-number").innerHTML = new_message;
  					break;
  				case 'home/temperature_power':
  					if(new_message =='on'){
  						//var val = $('#hvac_slider').prop('checked',true);
             		}else{
             			//var val = $('#hvac_slider').prop('checked',false);
             			//alert('off');
             		}
  					break;
  				case 'home/temperature_set':
  					var val = document.getElementById("set-temp-number").innerHTML = new_message;
  					break;
  				case 'home/security_power':
  					if(new_message =='on'){
  						//var val = $('#security_slider')
             		}else{
             			
             		}
  					break;
  				case 'home/blind_status':
  					if(new_message =='on'){
  						//var val = $('#hvac_slider')
             		}else{
             			
             		}
  					break;
  				default:
  					alert('no hits');
  			}
		}




            function plus() {
         		var val = document.getElementById("set-temp-number").innerHTML; 
            	var new_val = parseInt(document.getElementById("set-temp-number").innerHTML)+1;
            	document.getElementById("set-temp-number").innerHTML = new_val; 
            	pub(new_val.toString(),'home/temperature_set');
         	}

             function minus() {
                  var val = document.getElementById("set-temp-number").innerHTML; 
                  var new_val = parseInt(document.getElementById("set-temp-number").innerHTML)-1;
                  document.getElementById("set-temp-number").innerHTML = new_val; 
                  pub(new_val.toString(),'home/temperature_set');
             }

             function hvac_toggle() {
             	var val = $('#hvac_slider').prop("checked");
             	if(val){
             		pub('on','home/temperature_power');
             	}else{
             		pub('off','home/temperature_power');
             	}
            
    		}

 			function light_toggle() {
             	var val = $('#light_slider').prop("checked");
             	if(val){
             		pub('on','home/light_power');
             	}else{
             		pub('off','home/light_power');
             	}
            
    		}

    		function security_toggle() {
             	var val = $('#security_slider').prop("checked");
             	if(val){
             		pub('on','home/security_power');
             	}else{
             		pub('off','home/security_power');
             	}
    		}

    		function blind_toggle() {
             	var val = $('#blind_slider').prop("checked");
             	if(val){
             		pub('open','home/blind_status');
             	}else{
             		pub('closed','home/blind_status');
             	}
    		}

         
      </script>
   </head>
   <body>
      <div class="container-fluid">
      <header>Smart Home</header>
      <div class="row wide">
      <!-- LIGHTING -->
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" >
         <button  class="btn  btn-block btn-square background" href="#lights" data-toggle="collapse">Lighting <img class="nav-image" src="images/light.png"></button>
         <div id="lights" class="collapse col-lg-12 col-md-12 col-sm-12 col-xs-12">
         	<input type="checkbox">Enable Manual Control of Lights<br>
            <div class="tab-label">Light Intesity</div>
            <div class="circled-number"><span id="light-number">69</span></div>
            <div class="tab-label">Control Lights</div>
            <div class="button-div"><input type="checkbox" id="light_slider" onchange="light_toggle()" checked data-toggle="toggle" data-width="150"></div>
            <div class="tab-label">Blinds</div>
            <div class="button-div"><input type="checkbox" id="blind_slider" onchange="blind_toggle()" checked data-toggle="toggle"  data-width="150" data-on="Open" data-off="Closed"></div>
         </div>
      </div>
      <!-- HVAC -->
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <button class="btn  btn-block btn-square background" href="#hvac" data-toggle="collapse">HVAC <img class="nav-image" src="images/fan.png"></button>
      <div id="hvac" class="collapse">
      	<input type="checkbox">Enable Manual Control of Lights<br>
         <div class="tab-label">Temperature&#8457;</div>
         <div class="circled-number"><span id="temp-number">69</span></div>
         <div class="tab-label">Set Temperature</div>
         <div class="set-temp">
            <a onclick="minus()">
            <span class="glyphicon glyphicon-minus"></span>
            </a>
            <span id="set-temp-number">68</span>
            <a onclick="plus()">
            <span class="glyphicon glyphicon-plus"></span>
            </a>
         </div>
         <div class="button-div"><input type="checkbox" id="hvac_slider" onchange="hvac_toggle()" checked data-toggle="toggle" data-width="150"></div>
      </div>
  </div>
      <!-- SECURITY SYSTEM-->
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
         <button class="btn  btn-block btn-square background" href="#security" data-toggle="collapse">Security <img class="nav-image" src="images/security.png"></button>
         <div id="security" class="collapse">

        <video autoplay="true" id="videoElement">
 			
		</video>


         	<div class="tab-label" style="font-size: 18px;">Last Motion Detected: </div> 
            <div class="button-div"><input type="checkbox" id="security_slider" onchange="security_toggle()" checked data-toggle="toggle" data-width="150" data-on="Armed" data-off="Disarmed"></div>
         </div>
     </div>

         <!-- OTHER -->
         <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <button class="btn  btn-block btn-square background" href="#other" data-toggle="collapse">Other</button>
            <div id="other" class="collapse">
               <div class="tab-label">Other</div>
               <ul>
               		<li>Today's Solar Radiation</li>
               		<li>Today's UV Radiation</li>
               </ul>
               <table>
               	<tr><th>Category</th><th>Value</th></th></tr>
               	<tr><td>Light (hrs)</td><td></td></tr>

               </table>
            </div>
         </div>
      </div>
      <script>
         MQTTconnect(); 
          $(document).ready(function () {
              $("button").click(function () {
                  if ($(this).hasClass("btn-shrink")) {
                      $(this).toggleClass("btn-shrink");
                  }
                  else {
                      $(".background.btn-shrink").toggleClass("btn-shrink");
                      $(".collapse.in").removeClass("in");
                      $(this).toggleClass("btn-shrink");
                      $('html,body').animate({
                          scrollTop: ($(this).offset().top)
                      }, 500);
                  }
              });
           });            
      </script>
   </body>
</html>